<view class="psych-assessment-page"><view class="assessment-banner"><image class="banner-image" src="/static/images/psychology-banner.png" mode="aspectFill"></image><view class="banner-content"><text class="banner-title">心理健康评估</text><text class="banner-subtitle">关爱自己，从了解开始</text></view></view><view class="assessment-container"><view class="tabs"><block wx:for="{{tabs}}" wx:for-item="tab" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['switchTab',[index]]]]]}}" class="{{['tab-item',(currentTab===index)?'active':'']}}" bindtap="__e"><text>{{tab}}</text></view></block></view><block wx:if="{{currentTab===0}}"><view class="assessment-list"><view class="section-title"><text>专业评估问卷</text></view><view class="assessment-cards"><block wx:for="{{assessmentList}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['startAssessment',['$0'],[[['assessmentList','',index]]]]]]]}}" class="assessment-card" bindtap="__e"><view class="card-left"><image class="card-icon" src="{{item.icon}}" mode="aspectFit"></image></view><view class="card-content"><view class="card-title">{{item.title}}</view><view class="card-desc">{{item.description}}</view><view class="card-meta"><text class="meta-item"><text class="meta-label">题目:</text>{{''+item.questionCount+"题"}}</text><text class="meta-item"><text class="meta-label">时间:</text>{{'约'+item.timeNeeded+"分钟"}}</text></view></view><view class="card-right"><image class="arrow-icon" src="/static/images/arrow-right.png" mode="aspectFit"></image></view></view></block></view></view></block><block wx:if="{{currentTab===1}}"><view class="report-list"><view class="section-title"><text>我的评估报告</text></view><block wx:if="{{$root.g0===0}}"><view class="empty-state"><image class="empty-image" src="/static/images/empty-reports.png" mode="aspectFit"></image><text class="empty-text">暂无评估报告</text><button data-event-opts="{{[['tap',[['switchTab',[0]]]]]}}" class="primary-btn" bindtap="__e">去完成评估</button></view></block><block wx:else><view class="report-cards"><block wx:for="{{myReports}}" wx:for-item="report" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['viewReport',['$0'],[[['myReports','',index]]]]]]]}}" class="report-card" bindtap="__e"><view class="report-header"><text class="report-title">{{report.title}}</text><text class="report-date">{{report.date}}</text></view><view class="report-summary"><text class="summary-text">{{report.summary}}</text></view><view class="report-footer"><view class="score-display"><text class="score-label">总分</text><text class="score-value">{{report.score}}</text></view><button class="view-btn">查看详情</button></view></view></block></view></block></view></block><block wx:if="{{currentTab===2}}"><view class="counseling-section"><view class="section-title"><text>咨询师预约</text></view><view class="counselor-list"><block wx:for="{{$root.l0}}" wx:for-item="counselor" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['showCounselorDetail',['$0'],[[['counselors','',index]]]]]]]}}" class="counselor-card" bindtap="__e"><image class="counselor-avatar" src="{{counselor.$orig.avatar}}" mode="aspectFill"></image><view class="counselor-info"><view class="counselor-header"><text class="counselor-name">{{counselor.$orig.name}}</text><text class="counselor-title">{{counselor.$orig.title}}</text></view><view class="counselor-specialties"><text class="specialty-label">专长：</text><view class="specialty-tags"><block wx:for="{{counselor.$orig.specialties}}" wx:for-item="tag" wx:for-index="tagIndex" wx:key="tagIndex"><text class="specialty-tag">{{tag}}</text></block></view></view><view class="counselor-rating"><view class="stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i0__" wx:key="*this"><text class="{{['star',(n<=counselor.$orig.rating)?'active':'']}}">★</text></block></view><text class="rating-value">{{counselor.g1}}</text><text class="rating-count">{{"("+counselor.$orig.ratingCount+")"}}</text></view></view><button class="book-btn">预约</button></view></block></view></view></block></view><block wx:if="{{showCounselorDetailPopup}}"><view class="counselor-detail-popup"><view data-event-opts="{{[['tap',[['hideCounselorDetail',['$event']]]]]}}" class="popup-mask" bindtap="__e"></view><view class="popup-content"><view class="popup-header"><text class="popup-title">咨询师详情</text><view data-event-opts="{{[['tap',[['hideCounselorDetail',['$event']]]]]}}" class="popup-close" bindtap="__e"><image src="/static/images/close.png" mode="aspectFit"></image></view></view><view class="popup-body"><view class="counselor-profile"><image class="profile-avatar" src="{{currentCounselor.avatar}}" mode="aspectFill"></image><view class="profile-basic"><text class="profile-name">{{currentCounselor.name}}</text><text class="profile-title">{{currentCounselor.title}}</text><view class="profile-rating"><view class="stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i1__" wx:key="*this"><text class="{{['star',(n<=currentCounselor.rating)?'active':'']}}">★</text></block></view><text class="rating-value">{{$root.g2}}</text></view></view></view><view class="profile-detail"><view class="detail-item"><text class="detail-label">专业背景</text><text class="detail-value">{{currentCounselor.background}}</text></view><view class="detail-item"><text class="detail-label">咨询专长</text><view class="specialty-tags"><block wx:for="{{currentCounselor.specialties}}" wx:for-item="tag" wx:for-index="tagIndex" wx:key="tagIndex"><text class="specialty-tag">{{tag}}</text></block></view></view><view class="detail-item"><text class="detail-label">咨询风格</text><text class="detail-value">{{currentCounselor.style}}</text></view><view class="detail-item"><text class="detail-label">可预约时段</text><view class="time-slots"><view class="date-selector"><view data-event-opts="{{[['tap',[['previousDate',['$event']]]]]}}" class="date-arrow" bindtap="__e"><image src="/static/images/arrow-left.png" mode="aspectFit"></image></view><view class="dates"><block wx:for="{{availableDates}}" wx:for-item="date" wx:for-index="dateIndex" wx:key="dateIndex"><view data-event-opts="{{[['tap',[['selectDate',[dateIndex]]]]]}}" class="{{['date-item',(selectedDateIndex===dateIndex)?'active':'']}}" bindtap="__e"><text class="date-day">{{date.day}}</text><text class="date-weekday">{{date.weekday}}</text></view></block></view><view data-event-opts="{{[['tap',[['nextDate',['$event']]]]]}}" class="date-arrow" bindtap="__e"><image src="/static/images/arrow-right.png" mode="aspectFit"></image></view></view><view class="time-grid"><block wx:for="{{availableTimeSlots}}" wx:for-item="time" wx:for-index="timeIndex" wx:key="timeIndex"><view data-event-opts="{{[['tap',[['selectTime',[timeIndex,'$0'],[[['availableTimeSlots','',timeIndex]]]]]]]}}" class="{{['time-block',(time.available)?'available':'',(selectedTimeIndex===timeIndex&&time.available)?'selected':'']}}" bindtap="__e"><text>{{time.time}}</text></view></block></view></view></view></view><button class="{{['book-button',(!(selectedTimeIndex>=0))?'disabled':'']}}" disabled="{{!selectedTimeIndex>=0}}" data-event-opts="{{[['tap',[['bookAppointment',['$event']]]]]}}" bindtap="__e">确认预约</button></view></view></view></block></view>