<view class="library-page"><view class="search-container"><view class="search-bar"><input class="search-input" type="text" placeholder="搜索书名、作者或ISBN" data-event-opts="{{[['confirm',[['searchBooks',['$event']]]],['input',[['__set_model',['','searchKeyword','$event',[]]]]]]}}" value="{{searchKeyword}}" bindconfirm="__e" bindinput="__e"/><view data-event-opts="{{[['tap',[['searchBooks',['$event']]]]]}}" class="search-btn" bindtap="__e"><image src="/static/images/search.png" mode="aspectFit"></image></view></view><view data-event-opts="{{[['tap',[['scanBook',['$event']]]]]}}" class="scan-btn" bindtap="__e"><image src="/static/images/scan.png" mode="aspectFit"></image></view></view><block wx:if="{{!isSearchMode}}"><view data-event-opts="{{[['tap',[['startARNavigation',['$event']]]]]}}" class="ar-guide" bindtap="__e"><image class="ar-icon" src="/static/images/ar.png" mode="aspectFit"></image><view class="ar-text"><text class="ar-title">AR书架导航</text><text class="ar-desc">扫描书架码，轻松找到您要的图书</text></view><view class="ar-arrow"><image src="/static/images/arrow-right.png" mode="aspectFit"></image></view></view></block><view class="book-section"><view class="section-header"><text class="section-title">{{isSearchMode?'搜索结果':'推荐图书'}}</text><block wx:if="{{isSearchMode}}"><view data-event-opts="{{[['tap',[['showFilterOptions',['$event']]]]]}}" class="section-filter" bindtap="__e"><text>筛选</text><image src="/static/images/filter.png" mode="aspectFit"></image></view></block></view><scroll-view class="book-list" scroll-y="true"><block wx:for="{{displayBooks}}" wx:for-item="book" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['viewBookDetail',['$0'],[[['displayBooks','',index]]]]]]]}}" class="book-item" bindtap="__e"><image class="book-cover" src="{{book.cover}}" mode="aspectFill"></image><view class="book-info"><text class="book-title">{{book.title}}</text><text class="book-author">{{book.author}}</text><view class="book-tags"><block wx:for="{{book.tags}}" wx:for-item="tag" wx:for-index="tagIndex" wx:key="tagIndex"><text class="book-tag">{{tag}}</text></block></view><view class="{{['book-status',(book.available)?'available':'']}}"><text>{{book.available?'可借阅':'已借出'}}</text></view></view></view></block></scroll-view></view><view class="tab-bar"><view data-event-opts="{{[['tap',[['switchTab',['search']]]]]}}" class="tab-item" bindtap="__e"><image src="{{currentTab==='search'?'/static/images/search-active.png':'/static/images/search.png'}}" mode="aspectFit"></image><text class="{{[(currentTab==='search')?'active':'']}}">图书搜索</text></view><view data-event-opts="{{[['tap',[['switchTab',['shelf']]]]]}}" class="tab-item" bindtap="__e"><image src="{{currentTab==='shelf'?'/static/images/shelf-active.png':'/static/images/shelf.png'}}" mode="aspectFit"></image><text class="{{[(currentTab==='shelf')?'active':'']}}">我的书架</text></view><view data-event-opts="{{[['tap',[['switchTab',['history']]]]]}}" class="tab-item" bindtap="__e"><image src="{{currentTab==='history'?'/static/images/history-active.png':'/static/images/history.png'}}" mode="aspectFit"></image><text class="{{[(currentTab==='history')?'active':'']}}">借阅历史</text></view></view><block wx:if="{{showBookDetail}}"><view class="book-detail-popup"><view data-event-opts="{{[['tap',[['hideBookDetail',['$event']]]]]}}" class="popup-mask" bindtap="__e"></view><view class="popup-content"><view class="popup-header"><text class="popup-title">图书详情</text><view data-event-opts="{{[['tap',[['hideBookDetail',['$event']]]]]}}" class="popup-close" bindtap="__e"><image src="/static/images/close.png" mode="aspectFit"></image></view></view><view class="popup-body"><view class="detail-book"><image class="detail-cover" src="{{selectedBook.cover}}" mode="aspectFill"></image><view class="detail-info"><text class="detail-title">{{selectedBook.title}}</text><text class="detail-author">{{"作者: "+selectedBook.author}}</text><text class="detail-publisher">{{"出版社: "+selectedBook.publisher}}</text><text class="detail-isbn">{{"ISBN: "+selectedBook.isbn}}</text></view></view><view class="detail-section"><text class="detail-section-title">图书简介</text><text class="detail-description">{{selectedBook.description}}</text></view><view class="detail-section"><text class="detail-section-title">借阅信息</text><view class="detail-location"><text class="location-label">馆藏位置:</text><text class="location-value">{{selectedBook.location}}</text></view><view class="detail-availability"><text class="availability-label">借阅状态:</text><text class="{{['availability-value',(selectedBook.available)?'available':'']}}">{{selectedBook.available?'可借阅':'已借出'}}</text></view><block wx:if="{{!selectedBook.available}}"><view class="detail-duedate"><text class="duedate-label">预计归还日期:</text><text class="duedate-value">{{selectedBook.dueDate}}</text></view></block></view><view class="action-buttons"><block wx:if="{{selectedBook.available}}"><button data-event-opts="{{[['tap',[['borrowBook',['$event']]]]]}}" class="action-btn primary" bindtap="__e"><image src="/static/images/borrow.png" mode="aspectFit"></image><text>借阅图书</text></button></block><block wx:else><button data-event-opts="{{[['tap',[['reserveBook',['$event']]]]]}}" class="action-btn secondary" bindtap="__e"><image src="/static/images/reserve.png" mode="aspectFit"></image><text>预约图书</text></button></block><button data-event-opts="{{[['tap',[['locateBook',['$event']]]]]}}" class="action-btn secondary" bindtap="__e"><image src="/static/images/locate.png" mode="aspectFit"></image><text>查找位置</text></button></view></view></view></view></block><block wx:if="{{showARNavigation}}"><view class="ar-navigation"><view class="ar-camera"><image class="camera-preview" src="/static/images/ar-camera.png" mode="aspectFill"></image><view class="ar-direction"><image src="/static/images/ar-direction.png" mode="aspectFit"></image></view><view class="ar-shelf-marker"><text>历史文学区 A12</text></view></view><view class="ar-controls"><view class="ar-info"><text class="ar-distance">距离目标: 15米</text><text class="ar-target">目标: 历史文学区 A12-3</text></view><button data-event-opts="{{[['tap',[['exitARNavigation',['$event']]]]]}}" class="ar-exit-btn" bindtap="__e">退出导航</button></view></view></block></view>