<view class="classroom-page"><view class="floor-selector"><view class="building-picker"><picker value="{{currentBuildingIndex}}" range="{{buildings}}" data-event-opts="{{[['change',[['onBuildingChange',['$event']]]]]}}" bindchange="__e"><view class="picker-item"><text class="picker-text">{{buildings[currentBuildingIndex]}}</text><text class="picker-arrow">▼</text></view></picker></view><view class="floor-tabs"><block wx:for="{{floors}}" wx:for-item="floor" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectFloor',[index]]]]]}}" class="{{['floor-tab',(currentFloorIndex===index)?'active':'']}}" bindtap="__e"><text>{{floor}}</text></view></block></view></view><view class="floor-map-container"><view class="map-legend"><view class="legend-item"><view class="legend-color available"></view><text>可用</text></view><view class="legend-item"><view class="legend-color occupied"></view><text>已占用</text></view><view class="legend-item"><view class="legend-color maintenance"></view><text>维护中</text></view></view><view class="floor-map"><image class="map-image" src="/static/images/floor-map.png" mode="aspectFit"></image><block wx:for="{{currentFloorRooms}}" wx:for-item="room" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectRoom',['$0'],[[['currentFloorRooms','',index]]]]]]]}}" class="{{['room-marker',room.status]}}" style="{{'left:'+(room.position.x+'rpx')+';'+('top:'+(room.position.y+'rpx')+';')}}" bindtap="__e"><text class="room-code">{{room.code}}</text></view></block></view><view class="map-controls"><view data-event-opts="{{[['tap',[['zoomIn',['$event']]]]]}}" class="control-btn zoom-in" bindtap="__e"><image src="/static/images/zoom-in.png" mode="aspectFit"></image></view><view data-event-opts="{{[['tap',[['zoomOut',['$event']]]]]}}" class="control-btn zoom-out" bindtap="__e"><image src="/static/images/zoom-out.png" mode="aspectFit"></image></view><view data-event-opts="{{[['tap',[['rotate',['$event']]]]]}}" class="control-btn rotate" bindtap="__e"><image src="/static/images/rotate.png" mode="aspectFit"></image></view></view></view><view class="room-list"><text class="list-title">当前楼层教室</text><scroll-view class="list-scroll" scroll-y="true"><block wx:for="{{currentFloorRooms}}" wx:for-item="room" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectRoom',['$0'],[[['currentFloorRooms','',index]]]]]]]}}" class="{{['room-item',(selectedRoom&&selectedRoom.id===room.id)?'selected':'']}}" bindtap="__e"><view class="{{['room-status-dot',room.status]}}"></view><view class="room-info"><text class="room-name">{{room.name}}</text><text class="room-capacity">{{"容量: "+room.capacity+"人"}}</text></view><view class="room-equipment"><block wx:if="{{room.hasProjector}}"><view class="equipment-icon"><image src="/static/images/projector.png" mode="aspectFit"></image></view></block><block wx:if="{{room.hasComputer}}"><view class="equipment-icon"><image src="/static/images/computer.png" mode="aspectFit"></image></view></block><block wx:if="{{room.hasAirConditioner}}"><view class="equipment-icon"><image src="/static/images/ac.png" mode="aspectFit"></image></view></block></view></view></block></scroll-view></view><block wx:if="{{selectedRoom}}"><view class="time-selector"><view class="selected-room-info"><text class="room-title">{{selectedRoom.name}}</text><button data-event-opts="{{[['tap',[['closeRoomSelection',['$event']]]]]}}" class="close-btn" bindtap="__e">×</button></view><view class="date-selector"><view class="date-title">选择日期</view><picker mode="date" value="{{currentDate}}" start="{{startDate}}" end="{{endDate}}" data-event-opts="{{[['change',[['onDateChange',['$event']]]]]}}" bindchange="__e"><view class="date-picker"><text>{{currentDate}}</text><text class="picker-arrow">▼</text></view></picker></view><view class="time-slots-container"><view class="time-title">选择时段</view><scroll-view class="time-slots" scroll-x="true"><block wx:for="{{$root.l0}}" wx:for-item="slot" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['toggleTimeSlot',[index,'$0'],[[['timeSlots','',index]]]]]]]}}" class="{{['time-slot-item',(slot.g0)?'selected':'',(!slot.m0)?'disabled':'']}}" bindtap="__e"><text class="time-text">{{slot.$orig.time}}</text><text class="slot-status">{{slot.m1?'可用':'已约'}}</text></view></block></scroll-view></view><block wx:if="{{$root.g1>0}}"><view class="booking-summary"><view class="summary-title">预约信息</view><view class="summary-content"><view class="summary-item"><text class="summary-label">教室:</text><text class="summary-value">{{selectedRoom.name}}</text></view><view class="summary-item"><text class="summary-label">日期:</text><text class="summary-value">{{currentDate}}</text></view><view class="summary-item"><text class="summary-label">时间:</text><text class="summary-value">{{$root.m2}}</text></view></view></view></block><button class="submit-btn" disabled="{{$root.g2===0}}" data-event-opts="{{[['tap',[['submitBooking',['$event']]]]]}}" bindtap="__e">提交预约</button></view></block></view>