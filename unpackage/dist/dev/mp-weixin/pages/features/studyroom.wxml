<view class="studyroom-page data-v-ee71dbea"><view class="header data-v-ee71dbea"><text class="title data-v-ee71dbea">自习室预约</text><block wx:if="{{isExamPeriod}}"><view class="exam-period data-v-ee71dbea"><text class="data-v-ee71dbea">考试周 · 实时空位查询</text><button data-event-opts="{{[['tap',[['showRealtime',['$event']]]]]}}" class="realtime-btn data-v-ee71dbea" bindtap="__e">查看实时</button></view></block></view><view class="overview-section data-v-ee71dbea"><view class="overview-header data-v-ee71dbea"><text class="data-v-ee71dbea">自习室概览</text><view class="filter-container data-v-ee71dbea"><picker value="{{filterIndex}}" range="{{filterOptions}}" data-event-opts="{{[['change',[['filterChange',['$event']]]]]}}" bindchange="__e" class="data-v-ee71dbea"><view class="filter-text data-v-ee71dbea">{{filterOptions[filterIndex]}}</view></picker></view></view><view class="overview-stats data-v-ee71dbea"><view class="stat-box data-v-ee71dbea"><text class="stat-number data-v-ee71dbea">{{totalVacancies}}</text><text class="stat-label data-v-ee71dbea">总空位</text></view><view class="stat-box data-v-ee71dbea"><text class="stat-number data-v-ee71dbea">{{totalRooms}}</text><text class="stat-label data-v-ee71dbea">自习室</text></view><view class="stat-box data-v-ee71dbea"><text class="stat-number data-v-ee71dbea">{{peakHours}}</text><text class="stat-label data-v-ee71dbea">高峰时段</text></view></view></view><view class="room-list data-v-ee71dbea"><block wx:for="{{$root.l0}}" wx:for-item="room" wx:for-index="__i0__" wx:key="id"><view class="room-card data-v-ee71dbea"><view class="room-info data-v-ee71dbea"><view class="room-name-row data-v-ee71dbea"><text class="room-name data-v-ee71dbea">{{room.$orig.name}}</text><text class="room-location data-v-ee71dbea">{{room.$orig.location}}</text></view><view class="room-stats data-v-ee71dbea"><text class="stat-item data-v-ee71dbea">{{"总座位："+room.$orig.total}}</text><text class="stat-item data-v-ee71dbea">{{"空位："+room.$orig.available}}</text></view><view class="crowd-level data-v-ee71dbea"><text class="data-v-ee71dbea">拥挤程度：</text><text class="{{['data-v-ee71dbea','level',room.$orig.level]}}">{{room.m0}}</text></view><view class="room-capacity data-v-ee71dbea"><progress percent="{{(room.$orig.total-room.$orig.available)/room.$orig.total*100}}" stroke-width="4" activeColor="{{room.m1}}" backgroundColor="#f0f0f0" class="data-v-ee71dbea"></progress></view></view><button class="book-btn data-v-ee71dbea" disabled="{{room.$orig.available===0}}" data-event-opts="{{[['tap',[['bookRoom',['$0'],[[['filteredRooms','id',room.$orig.id]]]]]]]}}" bindtap="__e">{{''+(room.$orig.available===0?'已满':'预约座位')+''}}</button></view></block></view><block wx:if="{{showSeatSelector}}"><view class="seat-selector-mask data-v-ee71dbea"><view class="seat-selector data-v-ee71dbea"><view class="selector-header data-v-ee71dbea"><text class="data-v-ee71dbea">{{selectedRoom.name+" - 选择座位"}}</text><text data-event-opts="{{[['tap',[['closeSeatSelector',['$event']]]]]}}" class="close-btn data-v-ee71dbea" bindtap="__e">×</text></view><view class="seat-map data-v-ee71dbea"><view class="seat-layout data-v-ee71dbea"><view class="seat-grid data-v-ee71dbea"><block wx:for="{{seats}}" wx:for-item="seat" wx:for-index="__i1__" wx:key="id"><view data-event-opts="{{[['tap',[['selectSeat',['$0'],[[['seats','id',seat.id]]]]]]]}}" class="{{['data-v-ee71dbea','seat',seat.status]}}" bindtap="__e">{{''+seat.label+''}}</view></block></view></view><view class="seat-legend data-v-ee71dbea"><view class="legend-item data-v-ee71dbea"><view class="seat-demo available data-v-ee71dbea"></view>可选</view><view class="legend-item data-v-ee71dbea"><view class="seat-demo occupied data-v-ee71dbea"></view>已占</view><view class="legend-item data-v-ee71dbea"><view class="seat-demo selected data-v-ee71dbea"></view>已选</view></view></view><view class="time-selector data-v-ee71dbea"><text class="data-v-ee71dbea">选择时间段：</text><view class="time-picker-container data-v-ee71dbea"><picker mode="multiSelector" value="{{timeIndex}}" range="{{timeRange}}" data-event-opts="{{[['change',[['timeChange',['$event']]]]]}}" bindchange="__e" class="data-v-ee71dbea"><view class="time-display data-v-ee71dbea">{{''+timeRange[0][timeIndex[0]]+" - "+timeRange[1][timeIndex[1]]+''}}</view></picker></view></view><view class="selector-actions data-v-ee71dbea"><button data-event-opts="{{[['tap',[['closeSeatSelector',['$event']]]]]}}" class="cancel-btn data-v-ee71dbea" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['confirmBooking',['$event']]]]]}}" class="confirm-btn data-v-ee71dbea" bindtap="__e">确认预约</button></view></view></view></block><block wx:if="{{showVoucher}}"><view class="voucher-mask data-v-ee71dbea"><view class="voucher-popup data-v-ee71dbea"><view class="voucher-header data-v-ee71dbea"><text class="voucher-title data-v-ee71dbea">预约成功</text><text data-event-opts="{{[['tap',[['closeVoucher',['$event']]]]]}}" class="close-btn data-v-ee71dbea" bindtap="__e">×</text></view><view class="voucher-qr data-v-ee71dbea"><image src="/static/images/qr-code.png" mode="aspectFit" class="data-v-ee71dbea"></image></view><view class="voucher-info data-v-ee71dbea"><text class="voucher-room data-v-ee71dbea">{{voucher.room}}</text><view class="voucher-detail data-v-ee71dbea"><text class="data-v-ee71dbea">{{"座位号："+voucher.seat}}</text><text class="data-v-ee71dbea">{{"日期："+voucher.date}}</text><text class="data-v-ee71dbea">{{"时间："+voucher.time}}</text><text class="data-v-ee71dbea">{{"有效期至："+voucher.expire}}</text></view></view><view class="voucher-actions data-v-ee71dbea"><button data-event-opts="{{[['tap',[['addReminder',['$event']]]]]}}" class="reminder-btn data-v-ee71dbea" bindtap="__e"><text class="btn-icon data-v-ee71dbea">⏰</text><text class="data-v-ee71dbea">设置提醒</text></button><button data-event-opts="{{[['tap',[['saveVoucher',['$event']]]]]}}" class="save-btn data-v-ee71dbea" bindtap="__e"><text class="btn-icon data-v-ee71dbea">💾</text><text class="data-v-ee71dbea">保存凭证</text></button></view></view></view></block><block wx:if="{{showRealtimePanel}}"><view class="realtime-panel data-v-ee71dbea"><view class="realtime-content data-v-ee71dbea"><view class="realtime-header data-v-ee71dbea"><text class="data-v-ee71dbea">考试周自习室实时空位</text><text data-event-opts="{{[['tap',[['closeRealtime',['$event']]]]]}}" class="close-btn data-v-ee71dbea" bindtap="__e">×</text></view><view class="realtime-refresh data-v-ee71dbea"><text class="data-v-ee71dbea">{{lastUpdateTime+" 更新"}}</text><button data-event-opts="{{[['tap',[['refreshRealtime',['$event']]]]]}}" class="refresh-btn data-v-ee71dbea" bindtap="__e">刷新</button></view><view class="realtime-list data-v-ee71dbea"><block wx:for="{{rooms}}" wx:for-item="room" wx:for-index="__i2__" wx:key="id"><view class="realtime-item data-v-ee71dbea"><view class="realtime-room data-v-ee71dbea"><text class="room-name data-v-ee71dbea">{{room.name}}</text><text class="{{['data-v-ee71dbea','availability',room.level]}}">{{room.available+" / "+room.total}}</text></view><progress percent="{{room.available/room.total*100}}" stroke-width="3" activeColor="#4facfe" backgroundColor="#f0f0f0" class="data-v-ee71dbea"></progress></view></block></view><view class="realtime-note data-v-ee71dbea"><text class="data-v-ee71dbea">注：数据每5分钟自动更新一次</text></view></view></view></block></view>