<view class="medical-page"><view class="medical-banner"><image class="banner-image" src="/static/images/medical-banner.png" mode="aspectFill"></image><view class="banner-content"><text class="banner-title">校医预约</text><text class="banner-subtitle">方便快捷的校园医疗服务</text></view></view><view class="nav-tabs"><block wx:for="{{tabs}}" wx:for-item="tab" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['switchTab',[index]]]]]}}" class="{{['tab-item',(currentTab===index)?'active':'']}}" bindtap="__e"><text>{{tab}}</text></view></block></view><block wx:if="{{currentTab===0}}"><view class="tab-content"><view class="section section-departments"><view class="section-title"><text>选择科室</text></view><view class="departments-list"><block wx:for="{{departments}}" wx:for-item="dept" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectDepartment',[index]]]]]}}" class="{{['department-item',(selectedDepartment===index)?'active':'']}}" bindtap="__e"><image class="dept-icon" src="{{dept.icon}}" mode="aspectFit"></image><text class="dept-name">{{dept.name}}</text></view></block></view></view><block wx:if="{{selectedDepartment!==null}}"><view class="section section-date"><view class="section-title"><text>选择日期</text></view><view class="date-selector"><view data-event-opts="{{[['tap',[['prevDate',['$event']]]]]}}" class="date-arrow" bindtap="__e"><image src="/static/images/arrow-left.png" mode="aspectFit"></image></view><view class="dates"><block wx:for="{{availableDates}}" wx:for-item="date" wx:for-index="dateIndex" wx:key="dateIndex"><view data-event-opts="{{[['tap',[['selectDate',[dateIndex]]]]]}}" class="{{['date-item',(selectedDate===dateIndex)?'active':'']}}" bindtap="__e"><text class="date-day">{{date.day}}</text><text class="date-weekday">{{date.weekday}}</text></view></block></view><view data-event-opts="{{[['tap',[['nextDate',['$event']]]]]}}" class="date-arrow" bindtap="__e"><image src="/static/images/arrow-right.png" mode="aspectFit"></image></view></view></view></block><block wx:if="{{selectedDate!==null}}"><view class="section section-doctors"><view class="section-title"><text>选择医生</text></view><view class="doctors-list"><block wx:for="{{$root.l1}}" wx:for-item="doctor" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectDoctor',['$0'],[[['doctorsList','',index]]]]]]]}}" class="doctor-card" bindtap="__e"><image class="doctor-avatar" src="{{doctor.$orig.avatar}}" mode="aspectFill"></image><view class="doctor-info"><view class="doctor-header"><text class="doctor-name">{{doctor.$orig.name}}</text><text class="doctor-title">{{doctor.$orig.title}}</text></view><text class="doctor-specialty">{{doctor.$orig.specialty}}</text><view class="doctor-rating"><view class="stars"><block wx:for="{{5}}" wx:for-item="n" wx:for-index="__i0__" wx:key="*this"><text class="{{['star',(n<=doctor.$orig.rating)?'active':'']}}">★</text></block></view><text class="rating-text">{{doctor.$orig.ratingCount+"人评价"}}</text></view></view><view class="doctor-schedule"><view class="schedule-label">可预约：</view><view class="available-slots"><block wx:for="{{doctor.l0}}" wx:for-item="slot" wx:for-index="slotIndex" wx:key="slotIndex"><text data-event-opts="{{[['tap',[['selectTimeSlot',['$0','$1',slotIndex],[[['doctorsList','',index]],[['doctorsList','',index],['availableSlots','',slotIndex]]]]]]]}}" class="{{['time-slot',(slot.m0)?'selected':'']}}" catchtap="__e">{{''+slot.$orig+''}}</text></block></view></view></view></block></view></view></block><block wx:if="{{selectedDoctor&&selectedTimeSlot!==null}}"><view class="submit-section"><button data-event-opts="{{[['tap',[['submitAppointment',['$event']]]]]}}" class="submit-btn" bindtap="__e">确认预约</button></view></block></view></block><block wx:if="{{currentTab===1}}"><view class="tab-content"><view class="my-appointments"><view class="appointment-status-tabs"><block wx:for="{{appointmentStatusList}}" wx:for-item="status" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['switchStatusTab',[index]]]]]}}" class="{{['status-tab',(currentStatusTab===index)?'active':'']}}" bindtap="__e"><text>{{status}}</text></view></block></view><block wx:if="{{$root.g0>0}}"><view class="appointment-list"><block wx:for="{{$root.l2}}" wx:for-item="appointment" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['viewAppointmentDetail',['$0'],[[['filteredAppointments','',index]]]]]]]}}" class="appointment-card" bindtap="__e"><view class="appointment-info"><text class="appointment-dept">{{appointment.$orig.department}}</text><text class="appointment-doctor">{{appointment.$orig.doctorName+" "+appointment.$orig.doctorTitle}}</text><view class="appointment-time"><image src="/static/images/calendar.png" mode="aspectFit"></image><text>{{appointment.$orig.date+" "+appointment.$orig.time}}</text></view><view class="appointment-location"><image src="/static/images/location.png" mode="aspectFit"></image><text>{{appointment.$orig.location}}</text></view></view><view class="appointment-action"><view class="{{appointment.m1}}"><text>{{appointment.$orig.status}}</text></view><block wx:if="{{appointment.$orig.status==='待就诊'}}"><button data-event-opts="{{[['tap',[['cancelAppointment',['$0'],[[['filteredAppointments','',index]]]]]]]}}" class="action-btn" catchtap="__e">取消预约</button></block><block wx:if="{{appointment.$orig.status==='待就诊'}}"><button data-event-opts="{{[['tap',[['navigateToClinic',['$0'],[[['filteredAppointments','',index]]]]]]]}}" class="action-btn primary" catchtap="__e">前往就诊</button></block><block wx:if="{{appointment.$orig.status==='已完成'}}"><button data-event-opts="{{[['tap',[['viewMedicalRecord',['$0'],[[['filteredAppointments','',index]]]]]]]}}" class="action-btn" catchtap="__e">查看病历</button></block></view></view></block></view></block><block wx:else><view class="empty-state"><image class="empty-image" src="/static/images/empty-appointments.png" mode="aspectFit"></image><text class="empty-text">{{"暂无"+appointmentStatusList[currentStatusTab]+"的预约记录"}}</text></view></block></view></view></block><block wx:if="{{currentTab===2}}"><view class="tab-content"><view class="health-records"><view class="records-type-tabs"><block wx:for="{{healthRecordTypes}}" wx:for-item="type" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['switchRecordType',[index]]]]]}}" class="{{['record-type',(currentRecordType===index)?'active':'']}}" bindtap="__e"><image src="{{type.icon}}" mode="aspectFit"></image><text>{{type.name}}</text></view></block></view><block wx:if="{{currentRecordType===0}}"><view class="records-list"><view class="timeline"><block wx:for="{{medicalRecords}}" wx:for-item="record" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['viewRecordDetail',['$0'],[[['medicalRecords','',index]]]]]]]}}" class="timeline-item" bindtap="__e"><view class="timeline-dot"></view><view class="timeline-content"><view class="record-header"><text class="record-title">{{record.department+" - "+record.disease}}</text><text class="record-date">{{record.date}}</text></view><text class="record-doctor">{{record.doctorName+" "+record.doctorTitle}}</text><text class="record-desc">{{record.description}}</text><view class="record-tags"><block wx:for="{{record.tags}}" wx:for-item="tag" wx:for-index="tagIndex" wx:key="tagIndex"><text class="tag">{{tag}}</text></block></view></view></view></block></view></view></block><block wx:if="{{currentRecordType===1}}"><view class="records-list"><block wx:for="{{$root.l3}}" wx:for-item="report" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['viewExamReport',['$0'],[[['examReports','',index]]]]]]]}}" class="report-card" bindtap="__e"><view class="report-header"><text class="report-title">{{report.$orig.title}}</text><text class="report-date">{{report.$orig.date}}</text></view><view class="report-summary"><text class="summary-label">体检结论：</text><text class="summary-content">{{report.$orig.summary}}</text></view><view class="report-footer"><text class="report-location">{{report.$orig.location}}</text><view class="{{report.m2}}"><text>{{report.$orig.status}}</text></view></view></view></block></view></block><block wx:if="{{currentRecordType===2}}"><view class="records-list"><block wx:for="{{$root.l4}}" wx:for-item="vaccine" wx:for-index="index" wx:key="index"><view class="vaccine-card"><view class="vaccine-header"><text class="vaccine-name">{{vaccine.$orig.name}}</text><view class="{{vaccine.m3}}"><text>{{vaccine.$orig.status}}</text></view></view><view class="vaccine-info"><view class="vaccine-item"><text class="item-label">接种日期：</text><text class="item-value">{{vaccine.$orig.date||'未接种'}}</text></view><view class="vaccine-item"><text class="item-label">接种地点：</text><text class="item-value">{{vaccine.$orig.location||'未接种'}}</text></view><view class="vaccine-item"><text class="item-label">疫苗批次：</text><text class="item-value">{{vaccine.$orig.batch||'未接种'}}</text></view></view><block wx:if="{{vaccine.$orig.status==='未接种'}}"><button data-event-opts="{{[['tap',[['reserveVaccine',['$0'],[[['vaccineRecords','',index]]]]]]]}}" class="vaccine-btn" bindtap="__e">预约接种</button></block></view></block></view></block><block wx:if="{{currentRecordType===3}}"><view class="records-list"><view class="medication-list"><block wx:for="{{medications}}" wx:for-item="medicine" wx:for-index="index" wx:key="index"><view class="medication-item"><image class="medicine-image" src="{{medicine.image}}" mode="aspectFit"></image><view class="medicine-info"><text class="medicine-name">{{medicine.name}}</text><text class="medicine-usage">{{medicine.usage}}</text><view class="medicine-prescription"><text class="prescription-date">{{"处方日期："+medicine.prescriptionDate}}</text><text class="prescription-doctor">{{medicine.doctorName}}</text></view></view><view class="medicine-actions"><button data-event-opts="{{[['tap',[['viewMedicationDetail',['$0'],[[['medications','',index]]]]]]]}}" class="medicine-btn" bindtap="__e">详情</button></view></view></block></view></view></block></view></view></block><block wx:if="{{showAppointmentSuccess}}"><view class="modal appointment-success"><view data-event-opts="{{[['tap',[['hideAppointmentSuccess',['$event']]]]]}}" class="modal-mask" bindtap="__e"></view><view class="modal-content"><image class="success-icon" src="/static/images/success.png" mode="aspectFit"></image><text class="success-title">预约成功</text><view class="success-info"><view class="info-item"><text class="info-label">就诊科室：</text><text class="info-value">{{appointmentResult.department}}</text></view><view class="info-item"><text class="info-label">就诊医生：</text><text class="info-value">{{appointmentResult.doctorName}}</text></view><view class="info-item"><text class="info-label">就诊时间：</text><text class="info-value">{{appointmentResult.date+" "+appointmentResult.time}}</text></view><view class="info-item"><text class="info-label">就诊地点：</text><text class="info-value">{{appointmentResult.location}}</text></view></view><view class="success-notes"><text class="notes-title">就诊须知：</text><text class="notes-content">请提前10分钟到达就诊地点，携带学生证和校园卡。如需取消预约，请提前4小时操作。</text></view><view class="success-actions"><button data-event-opts="{{[['tap',[['addToCalendar',['$event']]]]]}}" class="action-btn" bindtap="__e">添加到日历</button><button data-event-opts="{{[['tap',[['hideAppointmentSuccess',['$event']]]]]}}" class="action-btn primary" bindtap="__e">完成</button></view></view></view></block><block wx:if="{{showAppointmentDetail}}"><view class="modal appointment-detail"><view data-event-opts="{{[['tap',[['hideAppointmentDetail',['$event']]]]]}}" class="modal-mask" bindtap="__e"></view><view class="modal-content"><view class="modal-header"><text class="modal-title">预约详情</text><view data-event-opts="{{[['tap',[['hideAppointmentDetail',['$event']]]]]}}" class="modal-close" bindtap="__e"><image src="/static/images/close.png" mode="aspectFit"></image></view></view><view class="detail-content"><view class="{{$root.m4}}"><text>{{currentAppointment.status}}</text></view><view class="detail-item"><text class="detail-label">就诊科室：</text><text class="detail-value">{{currentAppointment.department}}</text></view><view class="detail-item"><text class="detail-label">就诊医生：</text><text class="detail-value">{{currentAppointment.doctorName+" "+currentAppointment.doctorTitle}}</text></view><view class="detail-item"><text class="detail-label">就诊时间：</text><text class="detail-value">{{currentAppointment.date+" "+currentAppointment.time}}</text></view><view class="detail-item"><text class="detail-label">就诊地点：</text><text class="detail-value">{{currentAppointment.location}}</text></view><block wx:if="{{currentAppointment.notes}}"><view class="detail-item"><text class="detail-label">备注信息：</text><text class="detail-value">{{currentAppointment.notes}}</text></view></block><block wx:if="{{currentAppointment.status==='待就诊'}}"><view class="detail-actions"><button data-event-opts="{{[['tap',[['rescheduleAppointment',['$event']]]]]}}" class="action-btn" bindtap="__e">改期</button><button data-event-opts="{{[['tap',[['confirmCancelAppointment',['$event']]]]]}}" class="action-btn" bindtap="__e">取消预约</button><button data-event-opts="{{[['tap',[['navigateToClinic',['$0'],['currentAppointment']]]]]}}" class="action-btn primary" bindtap="__e">前往就诊</button></view></block></view></view></view></block></view>