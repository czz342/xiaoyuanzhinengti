{"version":3,"sources":["uni-app:///main.js","webpack:///D:/ËΩØ‰ª∂ÊùØ/Ê†°Âõ≠Êô∫ËÉΩ‰ΩìÂ∞èÁ®ãÂ∫è/pages/assistant/index.vue?d897","webpack:///D:/ËΩØ‰ª∂ÊùØ/Ê†°Âõ≠Êô∫ËÉΩ‰ΩìÂ∞èÁ®ãÂ∫è/pages/assistant/index.vue?f694","webpack:///D:/ËΩØ‰ª∂ÊùØ/Ê†°Âõ≠Êô∫ËÉΩ‰ΩìÂ∞èÁ®ãÂ∫è/pages/assistant/index.vue?92da","webpack:///D:/ËΩØ‰ª∂ÊùØ/Ê†°Âõ≠Êô∫ËÉΩ‰ΩìÂ∞èÁ®ãÂ∫è/pages/assistant/index.vue?9711","uni-app:///pages/assistant/index.vue","webpack:///D:/ËΩØ‰ª∂ÊùØ/Ê†°Âõ≠Êô∫ËÉΩ‰ΩìÂ∞èÁ®ãÂ∫è/pages/assistant/index.vue?e182","webpack:///D:/ËΩØ‰ª∂ÊùØ/Ê†°Âõ≠Êô∫ËÉΩ‰ΩìÂ∞èÁ®ãÂ∫è/pages/assistant/index.vue?9027"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","tunnelUrl","inputMessage","scrollTop","userAvatar","botAvatar","chatMessages","type","content","quickAccessItems","icon","text","path","ongoingTasks","sessionId","currentTaskId","isAssistantTyping","assistants","selectedAssistant","websocketTask","websocketConnected","reconnectInterval","onLoad","console","uni","title","methods","initializeAssistant","KingdeeAgentService","assistantsResponse","targetAssistantId","targetAssistantName","foundAssistant","timestamp","assistantIdToUse","callbackUrlToUse","sessionResponse","errMsg","error","stack","response","sendMessage","userMessage","messageToSend","userInput","lastMessageIndex","addSystemMessage","scrollToBottom","startVoiceInput","showAttachMenu","handleQuickAccess","url","viewTaskDetail","loadMoreMessages","handleWebhookData","taskId","message","handleAction","handleWaitingAction","handleChatAction","handleTaskAction","id","description","progress","status","statusText","remainingTime","getTaskStatusText","running","success","fail","getTaskIcon","addOrUpdateBotMessage","removeBotMessage","connectWebSocket","clearInterval","onUnload","code","reason"],"mappings":"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AU;gBACA;gBAAA;gBAGApB;gBACAC;kBAAAC;gBAAA;gBAAA;gBAAA,OAEAG;kBACAd;kBACA8B;gBACA;cAAA;gBAHAJ;gBAKAhB;gBACAD;;gBAEA;gBACA;kBACA;kBACAA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAC;gBACAD;gBACA;gBACA;gBACAsB;gBACA;kBACA,mFACAH;oBACAJ;oBACA9B;kBAAA,GACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAsC;MACA;QACAvC;QACAC;QACAyB;MACA;MACA;IACA;IAEA;IACAc;MAAA;MACA;QACA;QACA;QACA;QACA;MACA;IACA;IAEA;IACAC;MACAxB;QAAAC;QAAAf;MAAA;IACA;IAEA;IACAuC;MACAzB;QAAAC;QAAAf;MAAA;IACA;IAEA;IACAwC;MACA;QACA1B;UAAA2B;QAAA;MACA;QACA3B;UAAAC;UAAAf;QAAA;MACA;IACA;IAEA;IACA0C;MACA5B;QAAAC;QAAAf;MAAA;IACA;IAEA;IACA2C;MACA7B;QAAAC;QAAAf;MAAA;IACA;IAEA;IACA;IACA4C;MAAA;MACA/B;MAEA;QACAA;QACA;MACA;MAEA;QAAAT;QAAAyC;MACA;MAEA;QACAC;UAAA;QAAA;MACA;IACA;IAEAC;MACAlC;MACA;QACA;UACA;UACA;QACA;UACA;UACA;QACA;UACA;UACA;QACA;UACAA;MAAA;IAEA;IAEAmC;MACA;QACA;QACA;MACA;QAAA;QACA;QACA;MACA;IACA;IAEAC;MACA;MACA;;MAEA;MACA;MACA;QACA;MACA;QACApC;MACA;IACA;IAEAqC;MACA;MACA;QAAA;MAAA;MAEA;QACAC;QACApC;QACAqC;QACAC;QACAC;QAAA;QACAC;QACAC;QAAA;QACAxD;MACA;MAEA;QACA;MACA;QACA;MACA;IACA;IAEAyD;MACA;QACAC;QACAC;QACAC;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;IACA;IAEAC;MACA;QAAA;MAAA;MACA;QACA;QACA;QACA;MACA;QACA;QACA;UACAX;UACAtD;UACAC;UACAyB;QACA;MACA;MACA;IACA;IAEAwC;MACA;QAAA;MAAA;MACA;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MACA;MACAnD;MAEA;QACA4B;QACAkB;UACA9C;QACA;QACA+C;UACA/C;QACA;MACA;MAEA;QACAA;QACA;QACA;QACA;UACAoD;UACA;QACA;QACA;MACA;MAEA;QACApD;QACA;UACA;UACA;UACA;QACA;UACAA;QACA;MACA;MAEA;QACAA;QACA;QACA;MACA;MAEA;QACAA;QACA;QACA;;QAEA;QAEA;UACAA;UACA;QACA;MACA;IACA;EACA;EACAqD;IACA;IACA;MACA;QACAC;QACAC;MACA;IACA;IACA;IACA;MACAH;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACnjBA;AAAA;AAAA;AAAA;AAA+lC,CAAgB,8kCAAG,EAAC,C;;;;;;;;;;;ACAnnC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/assistant/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/assistant/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=411d5278&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=411d5278&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"411d5278\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/assistant/index.vue\"\nexport default component.exports","export * from \"-!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=411d5278&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.ongoingTasks.length\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"assistant-page\">\n\t\t<!-- ËÅäÂ§©Á™óÂè£ -->\n\t\t<scroll-view scroll-y=\"true\" class=\"chat-container\" :scroll-top=\"scrollTop\" :scroll-with-animation=\"true\" @scrolltoupper=\"loadMoreMessages\">\n\t\t\t<view class=\"chat-list\">\n\t\t\t\t<view v-for=\"(msg, index) in chatMessages\" :key=\"index\" class=\"chat-item\" :class=\"{ 'user-message': msg.type === 'user', 'system-message': msg.type === 'system' }\">\n\t\t\t\t\t<view class=\"avatar\">\n\t\t\t\t\t\t<image :src=\"msg.type === 'user' ? userAvatar : botAvatar\" mode=\"aspectFill\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"message-bubble\">\n\t\t\t\t\t\t<text>{{msg.content}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</scroll-view>\n\t\t\n\t\t<!-- Âä®ÊÄÅ‰ªªÂä°ËøΩË∏™Èù¢Êùø -->\n\t\t<view class=\"task-panel\" v-if=\"ongoingTasks.length > 0\">\n\t\t\t<text class=\"panel-title\">ËøõË°å‰∏≠ÁöÑ‰ªªÂä°</text>\n\t\t\t<scroll-view scroll-x=\"true\" class=\"task-scroll\">\n\t\t\t\t<view class=\"task-card\" v-for=\"(task, index) in ongoingTasks\" :key=\"index\" @tap=\"viewTaskDetail(task)\">\n\t\t\t\t\t<view class=\"task-icon\">\n\t\t\t\t\t\t<image :src=\"task.icon\" mode=\"aspectFit\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"task-info\">\n\t\t\t\t\t\t<text class=\"task-title\">{{task.title}}</text>\n\t\t\t\t\t\t<text class=\"task-desc\">{{task.description}}</text>\n\t\t\t\t\t\t<view class=\"progress-bar\">\n\t\t\t\t\t\t\t<view class=\"progress-fill\" :style=\"{ width: task.progress + '%' }\"></view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"task-time\">Ââ©‰ΩôÊó∂Èó¥: {{task.remainingTime}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"task-status\" :class=\"task.status\">\n\t\t\t\t\t\t<text>{{task.statusText}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t\t\n\t\t<!-- Â∫ïÈÉ®Âø´Êç∑Êåá‰ª§ËèúÂçï (ÂéüÈ°∂ÈÉ®ËèúÂçï) -->\n\t\t<view class=\"quick-access-menu\">\n\t\t\t<scroll-view scroll-x=\"true\" class=\"menu-scroll\">\n\t\t\t\t<view class=\"menu-item\" v-for=\"(item, index) in quickAccessItems\" :key=\"index\" @tap=\"handleQuickAccess(item)\">\n\t\t\t\t\t<view class=\"menu-icon\">\n\t\t\t\t\t\t<image :src=\"item.icon\" mode=\"aspectFit\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"menu-text\">{{item.text}}</text>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t</view>\n\t\t\n\t\t<!-- Â∫ïÈÉ®ËæìÂÖ•Âå∫Âüü -->\n\t\t<view class=\"input-area\">\n\t\t\t<view class=\"mic-btn\" @tap=\"startVoiceInput\">\n\t\t\t\t<image src=\"/static/images/scan.png\" mode=\"aspectFit\"></image>\n\t\t\t</view>\n\t\t\t<input type=\"text\" class=\"text-input\" v-model=\"inputMessage\" placeholder=\"ËØ∑ËæìÂÖ•Ê∂àÊÅØ...\" @confirm=\"sendMessage\"/>\n\t\t\t<view class=\"attach-btn\" @tap=\"showAttachMenu\">\n\t\t\t\t<image src=\"/static/images/filter.png\" mode=\"aspectFit\"></image>\n\t\t\t</view>\n\t\t\t<view class=\"send-btn\" @tap=\"sendMessage\">\n\t\t\t\t<image src=\"/static/images/arrow-right.png\" mode=\"aspectFit\"></image>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport KingdeeAgentService from '@/services/kingdeeAgent'\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\t// !!!ÈáçË¶Å!!!: ÊØèÊ¨°ÂêØÂä®cloudflaredÂêéÔºåËØ∑Âú®ËøôÈáåÊõ¥Êñ∞‰∏∫Êñ∞ÁöÑÂÖ¨ÁΩëÂú∞ÂùÄ\n\t\t\ttunnelUrl: \"https://collectible-decent-brokers-garcia.trycloudflare.com\", \n\t\t\t\n\t\t\tinputMessage: '',\n\t\t\tscrollTop: 0,\n\t\t\tuserAvatar: '/static/images/avatar.png',\n\t\t\tbotAvatar: '/static/images/assistant.png',\n\t\t\tchatMessages: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'system',\n\t\t\t\t\tcontent: 'ÊÇ®Â•ΩÔºÅÊàëÊòØÊ†°Âõ≠Êô∫ËÉΩ‰ΩìÔºåÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÂä©ÊÇ®ÁöÑÂêóÔºü'\n\t\t\t\t}\n\t\t\t],\n\t\t\tquickAccessItems: [\n\t\t\t\t{\n\t\t\t\t\ticon: '/static/images/schedule.png',\n\t\t\t\t\ttext: 'Êü•ËØæË°®',\n\t\t\t\t\tpath: '/pages/features/schedule'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ticon: '/static/images/food.png',\n\t\t\t\t\ttext: 'ËÆ¢È§ê',\n\t\t\t\t\tpath: '/pages/features/food'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ticon: '/static/images/library.png',\n\t\t\t\t\ttext: 'ÂÄü‰π¶',\n\t\t\t\t\tpath: '/pages/features/library'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ticon: '/static/images/classroom.png',\n\t\t\t\t\ttext: 'ÊïôÂÆ§È¢ÑÁ∫¶',\n\t\t\t\t\tpath: '/pages/features/classroom'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ticon: '/static/images/express.png',\n\t\t\t\t\ttext: 'Âø´ÈÄí',\n\t\t\t\t\tpath: '/pages/features/express'\n\t\t\t\t}\n\t\t\t],\n\t\t\tongoingTasks: [],\n\t\t\tsessionId: null,\n\t\t\tcurrentTaskId: null,\n\t\t\tisAssistantTyping: false,\n\t\t\tassistants: [],\n\t\t\tselectedAssistant: null,\n\t\t\twebsocketTask: null,\n\t\t\twebsocketConnected: false,\n\t\t\treconnectInterval: null\n\t\t}\n\t},\n\tasync onLoad() {\n\t\tconsole.log('È°µÈù¢Âä†ËΩΩÂºÄÂßã');\n\t\ttry {\n\t\t\tawait this.initializeAssistant();\n\t\t\t// ÂàùÂßãÂåñÊàêÂäüÂêéÔºåËøûÊé•WebSocket\n\t\t\tthis.connectWebSocket();\n\t\t\tconsole.log('È°µÈù¢ÂàùÂßãÂåñ‰∏éWebSocketËøûÊé•ÊµÅÁ®ãÂêØÂä®');\n\t\t} catch (error) {\n\t\t\tconsole.error('È°µÈù¢ÂàùÂßãÂåñÂ§±Ë¥•:', error);\n\t\t\tuni.showToast({\n\t\t\t\ttitle: 'ÂàùÂßãÂåñÂ§±Ë¥•ÔºåËØ∑ÈáçËØï',\n\t\t\t\ticon: 'none'\n\t\t\t});\n\t\t}\n\t},\n\tmethods: {\n\t\tasync initializeAssistant() {\n\t\t\tconsole.log('ÂºÄÂßãÂàùÂßãÂåñAIÂä©Êâã');\n\t\t\ttry {\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: 'Ê≠£Âú®ÂàùÂßãÂåñ...'\n\t\t\t\t});\n\n\t\t\t\t// Ëé∑ÂèñÂä©ÊâãÂàóË°®\n\t\t\t\tconsole.log('Ê≠£Âú®Ëé∑ÂèñÂä©ÊâãÂàóË°®...');\n\t\t\t\tconst assistantsResponse = await KingdeeAgentService.getAssistants();\n\t\t\t\tconsole.log('Ëé∑ÂèñÂà∞ÁöÑÂä©ÊâãÂàóË°®:', assistantsResponse);\n\t\t\t\t\n\t\t\t\tif (!assistantsResponse || !assistantsResponse.data || !Array.isArray(assistantsResponse.data) || !assistantsResponse.data.length) {\n\t\t\t\t\tconsole.error('Âä©ÊâãÂàóË°®Êó†ÊïàÊàñ‰∏∫Á©∫:', assistantsResponse);\n\t\t\t\t\tthrow new Error('Ëé∑ÂèñÂä©ÊâãÂàóË°®Â§±Ë¥•ÊàñÂàóË°®‰∏∫Á©∫');\n\t\t\t\t}\n\n\t\t\t\tthis.assistants = assistantsResponse.data;\n\t\t\t\tif (this.assistants && this.assistants.length > 0) {\n\t\t\t\t\t// ÁõÆÊ†áÂä©ÊâãÁöÑIDÂíåÂêçÁß∞\n\t\t\t\t\tconst targetAssistantId = \"2224845143255547904\";\n\t\t\t\t\tconst targetAssistantName = \"Ê†°Âõ≠Êô∫ËÉΩ‰Ωì\";\n\n\t\t\t\t\t// Â∞ùËØïÈÄöËøáIDÊü•ÊâæÂä©ÊâãÔºåÂ¶ÇÊûúÊâæ‰∏çÂà∞ÔºåÂÜçÂ∞ùËØïÈÄöËøáÂêçÁß∞Êü•Êâæ\n\t\t\t\t\tlet foundAssistant = this.assistants.find(assistant => assistant.id === targetAssistantId);\n\t\t\t\t\tif (!foundAssistant) {\n\t\t\t\t\t\tconsole.warn(`Êú™ÈÄöËøáID \"${targetAssistantId}\" ÊâæÂà∞Âä©ÊâãÔºåÂ∞ùËØïÈÄöËøáÂêçÁß∞ \"${targetAssistantName}\" Êü•Êâæ...`);\n\t\t\t\t\t\tfoundAssistant = this.assistants.find(assistant => assistant.name === targetAssistantName);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (foundAssistant) {\n\t\t\t\t\t\tthis.selectedAssistant = foundAssistant;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn(`‰πüÊú™ÈÄöËøáÂêçÁß∞ \"${targetAssistantName}\" ÊâæÂà∞Âä©ÊâãÔºåÂ∞ÜÈªòËÆ§‰ΩøÁî®ÂàóË°®‰∏≠ÁöÑÁ¨¨‰∏Ä‰∏™Âä©Êâã„ÄÇ`);\n\t\t\t\t\t\tthis.selectedAssistant = this.assistants[0]; // Â¶ÇÊûúÁâπÂÆöÂä©ÊâãÊú™ÊâæÂà∞ÔºåÂõûÈÄÄÂà∞Á¨¨‰∏Ä‰∏™\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log('Â∑≤ÈÄâÊã©Âä©Êâã:', JSON.parse(JSON.stringify(this.selectedAssistant)));\n\n\t\t\t\t\t// Êõ¥Êñ∞Ê¨¢ËøéÊ∂àÊÅØÁ≠â\n\t\t\t\t\tthis.chatMessages.unshift({\n\t\t\t\t\t\ttype: 'system',\n\t\t\t\t\t\tcontent: this.selectedAssistant.openingSpeech || `ÊÇ®Â•ΩÔºåÊàëÊòØÊÇ®ÁöÑÂä©Êâã ${this.selectedAssistant.name}ÔºåÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÂä©ÊÇ®ÁöÑÂêóÔºü`,\n\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t});\n\n\t\t\t\t\tuni.showLoading({ title: 'Ê≠£Âú®ÂàõÂª∫Êñ∞‰ºöËØù...' });\n\t\t\t\t\t\n\t\t\t\t\t// ‰ªéÈÄâ‰∏≠ÁöÑÂä©Êâã‰∏≠Ëé∑Âèñ assistantId\n\t\t\t\t\tconst assistantIdToUse = this.selectedAssistant.id; \n\t\t\t\t\t// Â∞ÜÂõûË∞ÉURLÊåáÂêëÊàë‰ª¨ÁöÑcloudflaredÊúçÂä°Âô®\n\t\t\t\t\tconst callbackUrlToUse = `${this.tunnelUrl}/webhook`;\n\n\t\t\t\t\tif (!assistantIdToUse) {\n\t\t\t\t\t\tconsole.error(\"Êó†Ê≥ï‰ªéselectedAssistant‰∏≠Ëé∑ÂèñÊúâÊïàÁöÑID!\");\n\t\t\t\t\t\tthrow new Error(\"Êó†Ê≥ïÂàùÂßãÂåñ‰ºöËØùÔºöÂä©ÊâãIDÁº∫Â§±„ÄÇ\");\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(`ÂáÜÂ§áË∞ÉÁî®createSessionÔºåassistantId: ${assistantIdToUse}, callbackUrl: ${callbackUrlToUse}`);\n\t\t\t\t\tconst sessionResponse = await KingdeeAgentService.createSession(assistantIdToUse, callbackUrlToUse);\n\t\t\t\t\tconsole.log('ÂàõÂª∫‰ºöËØùÂìçÂ∫î (ÂéüÂßã):', JSON.parse(JSON.stringify(sessionResponse))); // ‰ΩøÁî®Ê∑±Êã∑Ë¥ùÊâìÂç∞\n\n\t\t\t\t\t// Âú®Âà§Êñ≠ÂâçÊâìÂç∞ÂÖ≥ÈîÆÂÄºÂèäÂÖ∂Á±ªÂûã\n\t\t\t\t\tconsole.log('DEBUG: sessionResponse object:', sessionResponse);\n\t\t\t\t\tif (sessionResponse) {\n\t\t\t\t\t\tconsole.log('DEBUG: sessionResponse.status:', sessionResponse.status, 'type:', typeof sessionResponse.status);\n\t\t\t\t\t\tconsole.log('DEBUG: sessionResponse.data object:', sessionResponse.data);\n\t\t\t\t\t\tif (sessionResponse.data) {\n\t\t\t\t\t\t\tconsole.log('DEBUG: sessionResponse.data.sessionId:', sessionResponse.data.sessionId, 'type:', typeof sessionResponse.data.sessionId);\n\t\t\t\t\t\t\t// È¢ùÂ§ñÊ£ÄÊü•sessionIdÊòØÂê¶‰∏∫Á©∫Â≠óÁ¨¶‰∏≤ÊàñÂ∏ÉÂ∞îfalse\n\t\t\t\t\t\t\tconsole.log('DEBUG: sessionResponse.data.sessionId === \"\":', sessionResponse.data.sessionId === \"\");\n\t\t\t\t\t\t\tconsole.log('DEBUG: sessionResponse.data.sessionId === false:', sessionResponse.data.sessionId === false);\n\t\t\t\t\t\t\tconsole.log('DEBUG: !!sessionResponse.data.sessionId:', !!sessionResponse.data.sessionId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// ‰øÆÊ≠£Âπ∂Â¢ûÂº∫Âà§Êñ≠Êù°‰ª∂\n\t\t\t\t\tif (sessionResponse && \n\t\t\t\t\t    sessionResponse.status && // Ê£ÄÊü• status ÊòØÂê¶‰∏∫ÁúüÂÄº (true, \"true\", 1 Á≠âÈÉΩ‰ºöÈÄöËøá)\n\t\t\t\t\t    sessionResponse.data && \n\t\t\t\t\t    typeof sessionResponse.data.sessionId === 'string' && // Á°Æ‰øù sessionId ÊòØÂ≠óÁ¨¶‰∏≤\n\t\t\t\t\t    sessionResponse.data.sessionId.length > 0) { // Á°Æ‰øù sessionId ‰∏çÊòØÁ©∫Â≠óÁ¨¶‰∏≤\n\t\t\t\t\t\tthis.sessionId = sessionResponse.data.sessionId;\n\t\t\t\t\t\tconsole.log('Êñ∞‰ºöËØùÂàõÂª∫ÊàêÂäüÔºåSession ID:', this.sessionId);\n\t\t\t\t\t\tuni.setNavigationBarTitle({ title: `‰∏é ${this.selectedAssistant.name} ÂØπËØù‰∏≠` });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error('ÂàõÂª∫‰ºöËØùÂ§±Ë¥•ÊàñÊú™ËøîÂõûÊúâÊïàÁöÑsessionId (Ê£ÄÊü•Âêé):', sessionResponse);\n\t\t\t\t\t\t// ÊäõÂá∫Êõ¥ÂÖ∑‰ΩìÁöÑÈîôËØØ‰ø°ÊÅØÔºåÂ¶ÇÊûúÂèØËÉΩÁöÑËØù\n\t\t\t\t\t\tlet errMsg = 'ÂàõÂª∫‰ºöËØùÂ§±Ë¥•ÊàñÊú™ËøîÂõûÊúâÊïàÁöÑsessionId';\n\t\t\t\t\t\tif (sessionResponse && sessionResponse.data && typeof sessionResponse.data.sessionId === 'string' && sessionResponse.data.sessionId.length === 0) {\n\t\t\t\t\t\t\terrMsg = 'ÂàõÂª∫‰ºöËØùÊàêÂäüÔºå‰ΩÜËøîÂõûÁöÑsessionId‰∏∫Á©∫Â≠óÁ¨¶‰∏≤';\n\t\t\t\t\t\t} else if (sessionResponse && sessionResponse.data && typeof sessionResponse.data.sessionId !== 'string') {\n\t\t\t\t\t\t\terrMsg = `ÂàõÂª∫‰ºöËØùÊàêÂäüÔºå‰ΩÜsessionIdÁ±ªÂûã‰∏çÊ≠£Á°Æ (È¢ÑÊúüstringÔºåÂÆûÈôÖ${typeof sessionResponse.data.sessionId})`;\n\t\t\t\t\t\t} else if (sessionResponse && !sessionResponse.status) {\n\t\t\t\t\t\t\terrMsg = `ÂàõÂª∫‰ºöËØùAPIÂìçÂ∫îÁä∂ÊÄÅÈùûÊàêÂäü (status: ${sessionResponse.status})`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthrow new Error(sessionResponse?.message || errMsg);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn('Êú™Ëé∑ÂèñÂà∞Âä©ÊâãÂàóË°®ÔºåÊàñÂàóË°®‰∏∫Á©∫');\n\t\t\t\t\tthis.chatMessages.unshift({\n\t\t\t\t\t\ttype: 'system',\n\t\t\t\t\t\tcontent: 'Êä±Ê≠âÔºåÂä©ÊâãÂàóË°®‰∏∫Á©∫ÔºåÊó†Ê≥ïÂàùÂßãÂåñ‰ºöËØù„ÄÇ'\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tuni.hideLoading();\n\t\t\t\tconsole.log('ÂàùÂßãÂåñÂÆåÊàê');\n\t\t\t} catch (error) {\n\t\t\t\tuni.hideLoading();\n\t\t\t\tconsole.error('ÂàùÂßãÂåñAIÂä©ÊâãÂ§±Ë¥•:', {\n\t\t\t\t\terror: error.message,\n\t\t\t\t\tstack: error.stack,\n\t\t\t\t\tresponse: error.response\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// ‰ΩøÁî®ÈªòËÆ§Ê¨¢ËøéÊ∂àÊÅØ\n\t\t\t\tthis.chatMessages = [{\n\t\t\t\t\ttype: 'system',\n\t\t\t\t\tcontent: 'Êä±Ê≠âÔºåAIÂä©ÊâãËøûÊé•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ'\n\t\t\t\t}];\n\t\t\t\t\n\t\t\t\tthrow error; // Âêë‰∏ä‰º†Êí≠ÈîôËØØ\n\t\t\t}\n\t\t},\n\n\t\t// ÂèëÈÄÅÊ∂àÊÅØ\n\t\tasync sendMessage() {\n\t\t\tif (!this.inputMessage.trim()) {\n\t\t\t\tuni.showToast({ title: '‰∏çËÉΩÂèëÈÄÅÁ©∫Ê∂àÊÅØ', icon: 'none' });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this.sessionId) {\n\t\t\t\tuni.showToast({ title: '‰ºöËØùÊú™Âª∫Á´ãÔºåËØ∑Á®çÂêéÈáçËØï', icon: 'none' });\n\t\t\t\tconsole.error('sendMessage Â§±Ë¥•: sessionId ‰∏∫Á©∫');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst userMessage = {\n\t\t\t\ttype: 'user',\n\t\t\t\tcontent: this.inputMessage.trim(),\n\t\t\t\ttimestamp: Date.now()\n\t\t\t};\n\t\t\tthis.chatMessages.push(userMessage);\n\t\t\tthis.scrollToBottom();\n\n\t\t\tconst messageToSend = this.inputMessage;\n\t\t\tthis.inputMessage = ''; // Á´ãÂàªÊ∏ÖÁ©∫ËæìÂÖ•Ê°Ü\n\n\t\t\ttry {\n\t\t\t\tconsole.log(`ÂáÜÂ§áÂèëÈÄÅÊ∂àÊÅØ: \"${messageToSend}\" Âà∞ sessionId: ${this.sessionId}`);\n\t\t\t\tuni.showLoading({ title: 'Ê≠£Âú®ÂèëÈÄÅ...' });\n\t\t\t\t\n\t\t\t\tconst response = await KingdeeAgentService.sendChatMessage({\n\t\t\t\t\tsessionId: this.sessionId,\n\t\t\t\t\tuserInput: messageToSend\n\t\t\t\t});\n\n\t\t\t\tuni.hideLoading();\n\t\t\t\tconsole.log('Ê∂àÊÅØÂèëÈÄÅÊàêÂäüÔºåAPIÂìçÂ∫î:', response);\n\t\t\t\t\n\t\t\t\t// ËÆ∞ÂΩïËøîÂõûÁöÑtaskIdÔºåÂèØËÉΩÁî®‰∫éÂêéÁª≠Êìç‰ΩúÔºåÂ¶ÇÂÅúÊ≠¢‰ªªÂä°\n\t\t\t\tif (response && response.taskId) {\n\t\t\t\t\tthis.currentTaskId = response.taskId;\n\t\t\t\t\tconsole.log('ËÆ∞ÂΩïÂΩìÂâç‰ªªÂä°ID:', this.currentTaskId);\n\t\t\t\t}\n\n\t\t\t} catch (error) {\n\t\t\t\tuni.hideLoading();\n\t\t\t\tconsole.error('ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•:', error);\n\t\t\t\tthis.addSystemMessage(`Ê∂àÊÅØÂèëÈÄÅÂ§±Ë¥•: ${error.message || 'ÁΩëÁªúÈîôËØØ'}`);\n\t\t\t\t// ÂèØÈÄâÔºöÂ∞ÜÂèëÈÄÅÂ§±Ë¥•ÁöÑÊ∂àÊÅØÁä∂ÊÄÅÊõ¥Êñ∞\n\t\t\t\tconst lastMessageIndex = this.chatMessages.length - 1;\n\t\t\t\tif (this.chatMessages[lastMessageIndex] === userMessage) {\n\t\t\t\t\tthis.$set(this.chatMessages, lastMessageIndex, {\n\t\t\t\t\t\t...userMessage,\n\t\t\t\t\t\terror: true,\n\t\t\t\t\t\tcontent: userMessage.content + ' (ÂèëÈÄÅÂ§±Ë¥•)'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\taddSystemMessage(content) {\n\t\t\tthis.chatMessages.push({\n\t\t\t\ttype: 'system',\n\t\t\t\tcontent: content,\n\t\t\t\ttimestamp: Date.now()\n\t\t\t});\n\t\t\tthis.scrollToBottom();\n\t\t},\n\n\t\t// ÊªöÂä®Âà∞Â∫ïÈÉ®\n\t\tscrollToBottom() {\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tconst lastMessageIndex = this.chatMessages.length - 1;\n\t\t\t\tif (lastMessageIndex < 0) return;\n\t\t\t\t// ËøôÈáå‰ΩøÁî®‰∏Ä‰∏™ËæÉÂ§ßÁöÑÂÄºÊù•Á°Æ‰øùÊªöÂä®Âà∞Â∫ïÈÉ®\n\t\t\t\tthis.scrollTop = this.scrollTop + 9999;\n\t\t\t});\n\t\t},\n\t\t\n\t\t// ËØ≠Èü≥ËæìÂÖ•\n\t\tstartVoiceInput() {\n\t\t\tuni.showToast({ title: 'ËØ≠Èü≥ÂäüËÉΩÂºÄÂèë‰∏≠...', icon: 'none' });\n\t\t},\n\n\t\t// ÈôÑ‰ª∂ËèúÂçï\n\t\tshowAttachMenu() {\n\t\t\tuni.showToast({ title: 'ÈôÑ‰ª∂ÂäüËÉΩÂºÄÂèë‰∏≠...', icon: 'none' });\n\t\t},\n\t\t\n\t\t// Âø´Êç∑Êåá‰ª§Â§ÑÁêÜ\n\t\thandleQuickAccess(item) {\n\t\t\tif (item.path) {\n\t\t\t\tuni.navigateTo({ url: item.path });\n\t\t\t} else {\n\t\t\t\tuni.showToast({ title: 'ÂäüËÉΩÂºÄÂèë‰∏≠...', icon: 'none' });\n\t\t\t}\n\t\t},\n\n\t\t// Êü•Áúã‰ªªÂä°ËØ¶ÊÉÖ\n\t\tviewTaskDetail(task) {\n\t\t\tuni.showToast({ title: '‰ªªÂä°ËØ¶ÊÉÖÂäüËÉΩÂºÄÂèë‰∏≠...', icon: 'none' });\n\t\t},\n\t\t\n\t\t// Âä†ËΩΩÊõ¥Â§öÂéÜÂè≤Ê∂àÊÅØ\n\t\tloadMoreMessages() {\n\t\t\tuni.showToast({ title: 'Ê≤°ÊúâÊõ¥Â§öÂéÜÂè≤Ê∂àÊÅØ‰∫Ü', icon: 'none' });\n\t\t},\n\t\t\n\t\t// ‰ª•‰∏ãÊòØÂ§ÑÁêÜ‰ªéWebhookÊé•Êî∂Âà∞ÁöÑÊ∂àÊÅØÁöÑÈÄªËæë\n\t\t// Ê≥®ÊÑèÔºöËøôÈÉ®ÂàÜÈÄªËæëÁé∞Âú®ÈúÄË¶Å‰∏Ä‰∏™ÊúçÂä°Âô®Êù•Êé•Êî∂WebhookÂπ∂Â∞ÜÂÖ∂Êé®ÈÄÅÂà∞Â∞èÁ®ãÂ∫è\n\t\thandleWebhookData(payload) {\n\t\t\tconsole.log(\"Â§ÑÁêÜWebhookÊï∞ÊçÆ:\", payload);\n\n\t\t\tif (!payload || !payload.message) {\n\t\t\t\tconsole.warn(\"Êî∂Âà∞ÁöÑWebhookÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ\", payload);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tconst { message, sessionId, taskId } = payload;\n\t\t\tthis.currentTaskId = taskId;\n\n\t\t\tif (message.actionList && Array.isArray(message.actionList)) {\n\t\t\t\tmessage.actionList.forEach(action => this.handleAction(action));\n\t\t\t}\n\t\t},\n\t\t\n\t\thandleAction(action) {\n\t\t\tconsole.log(\"Â§ÑÁêÜAction:\", action);\n\t\t\tswitch(action.type) {\n\t\t\t\tcase 'waiting':\n\t\t\t\t\tthis.handleWaitingAction(action);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'chat':\n\t\t\t\t\tthis.handleChatAction(action);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'task':\n\t\t\t\t\tthis.handleTaskAction(action);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn(\"Êú™Áü•ÁöÑActionÁ±ªÂûã:\", action.type);\n\t\t\t}\n\t\t},\n\t\t\n\t\thandleWaitingAction(action) {\n\t\t\tif (action.waitState === 'start') {\n\t\t\t\tthis.isAssistantTyping = true;\n\t\t\t\tthis.addOrUpdateBotMessage(\"...\", \"typing_indicator\");\n\t\t\t} else { // end\n\t\t\t\tthis.isAssistantTyping = false;\n\t\t\t\tthis.removeBotMessage(\"typing_indicator\");\n\t\t\t}\n\t\t},\n\n\t\thandleChatAction(action) {\n\t\t\tthis.isAssistantTyping = false;\n\t\t\tthis.removeBotMessage(\"typing_indicator\"); // ÁßªÈô§\"Ê≠£Âú®ËæìÂÖ•\"\n\t\t\t\n\t\t\t// Ê†πÊçÆÁî®Êà∑Êèê‰æõÁöÑÊ≠£Á°ÆÊó•ÂøóÁªìÊûÑÔºå‰ªé action.data.message Ëé∑ÂèñÊñáÊú¨\n\t\t\t// Âπ∂‰ΩøÁî® action.data.taskId ‰Ωú‰∏∫ÂîØ‰∏ÄÊ†áËØÜÁ¨¶Êù•ÂêàÂπ∂ÊµÅÂºèÊ∂àÊÅØ\n\t\t\tif (action.data && action.data.message) {\n\t\t\t\tthis.addOrUpdateBotMessage(action.data.message, action.data.taskId);\n\t\t\t} else {\n\t\t\t\tconsole.error(\"Êî∂Âà∞ÁöÑchat actionÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºåÁº∫Â∞ë data.message:\", action);\n\t\t\t}\n\t\t},\n\t\t\n\t\thandleTaskAction(action) {\n\t\t\tconst taskData = action.task;\n\t\t\tconst existingTaskIndex = this.ongoingTasks.findIndex(t => t.id === taskData.taskId);\n\n\t\t\tconst formattedTask = {\n\t\t\t\tid: taskData.taskId,\n\t\t\t\ttitle: taskData.taskTitle,\n\t\t\t\tdescription: taskData.taskDesc,\n\t\t\t\tprogress: parseInt(taskData.progress, 10),\n\t\t\t\tstatus: taskData.status, // running, success, fail\n\t\t\t\tstatusText: this.getTaskStatusText(taskData.status),\n\t\t\t\tremainingTime: \"ËÆ°ÁÆó‰∏≠...\", // ÈúÄË¶ÅÈÄªËæëÊù•ËÆ°ÁÆó\n\t\t\t\ticon: this.getTaskIcon(taskData.taskTitle)\n\t\t\t};\n\t\t\t\n\t\t\tif (existingTaskIndex > -1) {\n\t\t\t\tthis.$set(this.ongoingTasks, existingTaskIndex, formattedTask);\n\t\t\t} else {\n\t\t\t\tthis.ongoingTasks.push(formattedTask);\n\t\t\t}\n\t\t},\n\n\t\tgetTaskStatusText(status) {\n\t\t\tconst map = {\n\t\t\t\trunning: \"ËøõË°å‰∏≠\",\n\t\t\t\tsuccess: \"Â∑≤ÂÆåÊàê\",\n\t\t\t\tfail: \"Â∑≤Â§±Ë¥•\",\n\t\t\t};\n\t\t\treturn map[status] || \"Êú™Áü•\";\n\t\t},\n\n\t\tgetTaskIcon(title) {\n\t\t\tif (title.includes(\"ËØæË°®\")) return \"/static/images/schedule.png\";\n\t\t\tif (title.includes(\"ËÆ¢È§ê\")) return \"/static/images/food.png\";\n\t\t\treturn \"/static/images/task.png\"; // ÈªòËÆ§ÂõæÊ†á\n\t\t},\n\n\t\taddOrUpdateBotMessage(content, messageId) {\n\t\t\tconst existingMsgIndex = this.chatMessages.findIndex(m => m.id === messageId);\n\t\t\tif (existingMsgIndex > -1) {\n\t\t\t\t// Êõ¥Êñ∞Áé∞ÊúâÊ∂àÊÅØ\n\t\t\t\tconst msg = this.chatMessages[existingMsgIndex];\n\t\t\t\tthis.$set(this.chatMessages[existingMsgIndex], 'content', msg.content + content);\n\t\t\t} else {\n\t\t\t\t// Ê∑ªÂä†Êñ∞Ê∂àÊÅØ\n\t\t\t\tthis.chatMessages.push({\n\t\t\t\t\tid: messageId,\n\t\t\t\t\ttype: 'system',\n\t\t\t\t\tcontent: content,\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.scrollToBottom();\n\t\t},\n\t\t\n\t\tremoveBotMessage(messageId) {\n\t\t\tconst msgIndex = this.chatMessages.findIndex(m => m.id === messageId);\n\t\t\tif (msgIndex > -1) {\n\t\t\t\tthis.chatMessages.splice(msgIndex, 1);\n\t\t\t}\n\t\t},\n\n\t\t// --- WebSocketÁõ∏ÂÖ≥ÊñπÊ≥ï ---\n\t\tconnectWebSocket() {\n\t\t\t// ‰ªé \"https://xxx.com\" ÁîüÊàê \"wss://xxx.com\"\n\t\t\tconst wsUrl = this.tunnelUrl.replace(/^http/, 'ws');\n\t\t\tconsole.log(`Â∞ùËØïËøûÊé•WebSocket: ${wsUrl}`);\n\n\t\t\tthis.websocketTask = uni.connectSocket({\n\t\t\t\turl: wsUrl,\n\t\t\t\tsuccess: () => {\n\t\t\t\t\tconsole.log(\"uni.connectSocket Ë∞ÉÁî®ÊàêÂäü\");\n\t\t\t\t},\n\t\t\t\tfail: (err) => {\n\t\t\t\t\tconsole.error(\"uni.connectSocket Ë∞ÉÁî®Â§±Ë¥•\", err);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.websocketTask.onOpen(() => {\n\t\t\t\tconsole.log('‚úÖ WebSocket ËøûÊé•Â∑≤ÊâìÂºÄ');\n\t\t\t\tthis.websocketConnected = true;\n\t\t\t\t// Ê∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÈáçËøûÂÆöÊó∂Âô®\n\t\t\t\tif (this.reconnectInterval) {\n\t\t\t\t\tclearInterval(this.reconnectInterval);\n\t\t\t\t\tthis.reconnectInterval = null;\n\t\t\t\t}\n\t\t\t\tthis.addSystemMessage(\"Êô∫ËÉΩÂä©ÊâãËøûÊé•ÊàêÂäüÔºÅ\");\n\t\t\t});\n\n\t\t\tthis.websocketTask.onMessage((res) => {\n\t\t\t\tconsole.log('Êî∂Âà∞WebSocketÊ∂àÊÅØ:', res.data);\n\t\t\t\ttry {\n\t\t\t\t\tconst payload = JSON.parse(res.data);\n\t\t\t\t\t// Ë∞ÉÁî®Êàë‰ª¨Â∑≤ÁªèÂÜôÂ•ΩÁöÑWebhookÂ§ÑÁêÜÈÄªËæë\n\t\t\t\t\tthis.handleWebhookData(payload);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Ëß£ÊûêWebSocketÊ∂àÊÅØÂ§±Ë¥•:', e);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.websocketTask.onError((err) => {\n\t\t\t\tconsole.error('WebSocket ËøûÊé•ÂèëÁîüÈîôËØØ:', err);\n\t\t\t\tthis.websocketConnected = false;\n\t\t\t\tthis.addSystemMessage(\"‰∏éÂä©ÊâãÁöÑËøûÊé•ÂèëÁîüÈîôËØØÔºåËØ∑Ê£ÄÊü•ÁΩëÁªú„ÄÇ\");\n\t\t\t});\n\n\t\t\tthis.websocketTask.onClose((res) => {\n\t\t\t\tconsole.log('üîå WebSocket ËøûÊé•Â∑≤ÂÖ≥Èó≠', res);\n\t\t\t\tthis.websocketConnected = false;\n\t\t\t\tif (this.reconnectInterval) return; // Èò≤Ê≠¢ÈáçÂ§çËÆæÁΩÆ\n\t\t\t\t\n\t\t\t\tthis.addSystemMessage(\"‰∏éÂä©ÊâãËøûÊé•Â∑≤Êñ≠ÂºÄÔºåÂ∞ùËØïÈáçÊñ∞ËøûÊé•...\");\n\t\t\t\t\n\t\t\t\tthis.reconnectInterval = setInterval(() => {\n\t\t\t\t\tconsole.log(\"Â∞ùËØïÈáçÊñ∞ËøûÊé•WebSocket...\");\n\t\t\t\t\tthis.connectWebSocket();\n\t\t\t\t}, 5000); // ÊØè5ÁßíÈáçËøû‰∏ÄÊ¨°\n\t\t\t});\n\t\t}\n\t},\n\tonUnload() {\n\t\t// È°µÈù¢Âç∏ËΩΩÊó∂ÂÖ≥Èó≠WebSocketËøûÊé•\n\t\tif (this.websocketTask) {\n\t\t\tthis.websocketTask.close({\n\t\t\t\tcode: 1000,\n\t\t\t\treason: 'È°µÈù¢ÂÖ≥Èó≠'\n\t\t\t});\n\t\t}\n\t\t// Ê∏ÖÈô§ÈáçËøûÂÆöÊó∂Âô®\n\t\tif(this.reconnectInterval) {\n\t\t\tclearInterval(this.reconnectInterval);\n\t\t\tthis.reconnectInterval = null;\n\t\t}\n\t}\n}\n</script>\n\n<style scoped>\n/* ... existing styles ... */\n.assistant-page {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100vh;\n\tbackground-color: #f5f5f5;\n\tpadding-bottom: env(safe-area-inset-bottom);\n}\n\n/* Âø´Êç∑Êåá‰ª§ËèúÂçïÊ†∑Âºè - Áé∞Âú®ÊîæÂú®Â∫ïÈÉ® */\n.quick-access-menu {\n\tbackground-color: #ffffff;\n\tpadding: 20rpx 0;\n\tborder-top: 1rpx solid #e0e0e0;\n\tbox-shadow: 0 -2rpx 6rpx rgba(0, 0, 0, 0.1);\n\tposition: relative;\n\tz-index: 10;\n}\n\n.menu-scroll {\n\twhite-space: nowrap;\n\tpadding: 0 20rpx;\n}\n\n.menu-item {\n\tdisplay: inline-block;\n\ttext-align: center;\n\tmargin-right: 30rpx;\n\twidth: 120rpx;\n}\n\n.menu-icon {\n\twidth: 80rpx;\n\theight: 80rpx;\n\tmargin: 0 auto;\n\tbackground-color: #e6f2ff;\n\tborder-radius: 50%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.menu-icon image {\n\twidth: 50rpx;\n\theight: 50rpx;\n}\n\n.menu-text {\n\tfont-size: 24rpx;\n\tcolor: #333;\n\tmargin-top: 10rpx;\n}\n\n/* ËÅäÂ§©Á™óÂè£ */\n.chat-container {\n\tflex: 1;\n\tpadding: 20rpx;\n\toverflow-y: auto;\n}\n\n.chat-list {\n\tpadding-bottom: 20rpx;\n}\n\n.chat-item {\n\tdisplay: flex;\n\tmargin-bottom: 30rpx;\n}\n\n.user-message {\n\tflex-direction: row-reverse;\n}\n\n.avatar {\n\twidth: 80rpx;\n\theight: 80rpx;\n\tborder-radius: 50%;\n\toverflow: hidden;\n\tflex-shrink: 0;\n}\n\n.avatar image {\n\twidth: 100%;\n\theight: 100%;\n}\n\n.message-bubble {\n\tmax-width: 70%;\n\tpadding: 20rpx;\n\tborder-radius: 20rpx;\n\tmargin: 0 20rpx;\n\tword-break: break-all;\n}\n\n.system-message .message-bubble {\n\tbackground-color: #007AFF;\n\tcolor: #ffffff;\n\tborder-top-left-radius: 0;\n}\n\n.user-message .message-bubble {\n\tbackground-color: #E0E0E0;\n\tcolor: #333333;\n\tborder-top-right-radius: 0;\n}\n\n/* ‰ªªÂä°Èù¢Êùø */\n.task-panel {\n\tbackground-color: #ffffff;\n\tpadding: 20rpx;\n\tborder-top: 1rpx solid #e0e0e0;\n\tborder-bottom: 1rpx solid #e0e0e0;\n}\n\n.panel-title {\n\tfont-size: 28rpx;\n\tfont-weight: bold;\n\tcolor: #333;\n\tmargin-bottom: 20rpx;\n}\n\n.task-scroll {\n\twhite-space: nowrap;\n}\n\n.task-card {\n\tdisplay: inline-block;\n\twidth: 450rpx;\n\tbackground-color: #ffffff;\n\tborder-radius: 20rpx;\n\tpadding: 20rpx;\n\tmargin-right: 20rpx;\n\tbox-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.1);\n\tposition: relative;\n}\n\n.task-icon {\n\twidth: 60rpx;\n\theight: 60rpx;\n\tposition: absolute;\n\ttop: 20rpx;\n\tleft: 20rpx;\n}\n\n.task-icon image {\n\twidth: 100%;\n\theight: 100%;\n}\n\n.task-info {\n\tmargin-left: 80rpx;\n}\n\n.task-title {\n\tfont-size: 28rpx;\n\tfont-weight: bold;\n\tcolor: #333;\n}\n\n.task-desc {\n\tfont-size: 24rpx;\n\tcolor: #666;\n\tmargin: 10rpx 0;\n}\n\n.progress-bar {\n\theight: 10rpx;\n\tbackground-color: #f0f0f0;\n\tborder-radius: 5rpx;\n\toverflow: hidden;\n\tmargin: 10rpx 0;\n}\n\n.progress-fill {\n\theight: 100%;\n\tbackground-color: #007AFF;\n}\n\n.task-time {\n\tfont-size: 24rpx;\n\tcolor: #999;\n}\n\n.task-status {\n\tposition: absolute;\n\ttop: 20rpx;\n\tright: 20rpx;\n\tpadding: 5rpx 10rpx;\n\tborder-radius: 10rpx;\n\tfont-size: 22rpx;\n}\n\n.task-status.processing {\n\tbackground-color: #e6f2ff;\n\tcolor: #007AFF;\n}\n\n.task-status.ready {\n\tbackground-color: #e6fff2;\n\tcolor: #00B578;\n}\n\n.task-status.warning {\n\tbackground-color: #fff9e6;\n\tcolor: #FF9500;\n}\n\n/* Â∫ïÈÉ®ËæìÂÖ•Âå∫Âüü */\n.input-area {\n\tbackground-color: #ffffff;\n\tpadding: 20rpx;\n\tborder-top: 1rpx solid #e0e0e0;\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.mic-btn, .attach-btn, .send-btn {\n\twidth: 60rpx;\n\theight: 60rpx;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.mic-btn image, .attach-btn image, .send-btn image {\n\twidth: 40rpx;\n\theight: 40rpx;\n}\n\n.text-input {\n\tflex: 1;\n\theight: 70rpx;\n\tbackground-color: #f5f5f5;\n\tborder-radius: 35rpx;\n\tpadding: 0 20rpx;\n\tmargin: 0 20rpx;\n\tfont-size: 28rpx;\n}\n</style> ","import mod from \"-!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=411d5278&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=411d5278&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1749358752308\n      var cssReload = require(\"D:/app/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}